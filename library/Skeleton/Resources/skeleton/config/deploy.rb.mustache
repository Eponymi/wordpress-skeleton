require "capistrano/php"
require "capistrano/ext/multistage"
require "railsless-deploy"
require "yaml"

set :stage_dir,     "deploy"
set :application,   "{{domain}}"

after "deploy:setup" do
    run "#{try_sudo} chown #{user} #{deploy_to}"
end

after "deploy:update_code", "wp:config:symlink", "wp:theme:symlink"
after "deploy:update_code", "wp:plugins:install", "wp:theme:activate"

namespace :deploy do
    task :cold do
        after "deploy:update_code", "wp:db:create", "wp:install"

        setup
        update
        start
    end
end
