require "capistrano/php"
require "capistrano/ext/multistage"
require "railsless-deploy"
require "yaml"

# WordPress Skeleton config
set :skeleton,      YAML.load_file(File.dirname(__FILE__) + "/skeleton.yml")

set :stage_dir,     "deploy"
set :application,   "{{name}}"

after "deploy:setup" do
    run "#{try_sudo} chown #{user} #{deploy_to}"
end

after "deploy:update_code" do
    set :config_dir,    "#{latest_release}/config"

    run "#{try_sudo} ln -s #{config_dir}/deploy/wp-config-#{stage}.php #{latest_release}/web/wp-config.php"
end
