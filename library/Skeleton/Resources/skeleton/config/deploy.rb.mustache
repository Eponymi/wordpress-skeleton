require "capistrano/php"
require "capistrano/ext/multistage"
require "railsless-deploy"
require "yaml"

# WordPress Skeleton config
set :skeleton,      YAML.load_file(File.dirname(__FILE__) + "/skeleton.yml")

set :stage_dir,     "deploy"
set :application,   "{{name}}"

namespace :deploy do
    task :cold do
        setup
        update

        wordpress.db.create
        wordpress.install
        wordpress.plugins.install
        wordpress.theme.activate

        start
    end
end

after "deploy:setup" do
    run "#{try_sudo} chown #{user} #{deploy_to}"
end

after "deploy:update_code", "wordpress:symlink"
after "deploy:update_code", "wordpress:config:symlink"
