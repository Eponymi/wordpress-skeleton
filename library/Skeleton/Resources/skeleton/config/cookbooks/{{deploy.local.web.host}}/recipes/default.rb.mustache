# WordPress dependencies
include_recipe "apt"
include_recipe "apache2"
include_recipe "mysql::server"
include_recipe "php"
include_recipe "php::module_mysql"
include_recipe "apache2::mod_php5"

# Enable VirtualDocumentRoot
apache_module "vhost_alias"

# Enable RewriteEngine
apache_module "rewrite"

# Disable default Apache site
apache_site "000-default" do
  enable false
end

# Create WordPress vhost
link "#{node['apache']['dir']}/sites-available/{{deploy.local.web.host}}" do
    to "/var/www/{{deploy.local.web.host}}/current/config/vhost/{{deploy.local.web.host}}"
end

# Activate WordPress vhost
apache_site "{{deploy.local.web.host}}"
